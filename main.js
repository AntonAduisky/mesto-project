(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{vV:()=>U,Sl:()=>H,eU:()=>M});var t={formSelector:".edit-form",inputSelector:".edit-form__item",errorClass:"error-message_visible",inputInvalidClass:"edit-form__item_invalid",buttonSelector:".edit-form__save-button",buttonDisabledClass:"edit-form__save-button_disabled"},n=function(e,t){e.classList.add(t.buttonDisabledClass),e.disabled=!0},r=function(e,t,r){var o=e.querySelector(r.buttonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.buttonDisabledClass),e.disabled=!1}(o,r):n(o,r)},o={url:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"56e44e9a-e6f9-47b7-ac5a-35eba224a4da","Content-Type":"application/json"}},c=function(e){return e.ok?e.json():Promise.reject(new Error("Произошла ошибка со статус-кодом ".concat(e.status)))};const a=function(){return fetch("".concat(o.url,"/cards"),{headers:o.headers}).then((function(e){return c(e)}))};var u="popup_opened",i=document.querySelector(".wrapper"),l=function(){return document.querySelector(".".concat(u))};function s(e){e.classList.add(u),i.addEventListener("click",f),document.addEventListener("keydown",m),document.addEventListener("click",v)}function d(e){e.classList.remove(u),i.removeEventListener("click",f),document.removeEventListener("keydown",m),document.removeEventListener("click",v)}function f(e){e.target.classList.contains(u)&&d(l())}function m(e){"Escape"===e.key&&d(l())}function v(e){e.target.classList.contains("popup__close-button")&&d(l())}document.querySelector(".elements");var y=document.querySelector("#cardTemplate").content,p=document.querySelector(".elements__list");function _(e,t,n,r,o,c,a,u){var i=y.querySelector(".elements__item").cloneNode(!0),l=i.querySelector(".elements__element-title"),d=i.querySelector(".elements__element-image"),f=i.querySelector(".elements__element-like"),m=i.querySelector(".elements__element-delete"),v=i.querySelector(".elements__element-like-count");return r.some((function(e){return e._id===o}))&&f.classList.add("elements__element-like_active"),o!==c._id&&m.remove(),d.src=t,d.alt=e,l.textContent=e,i.dataset.id=n,v.textContent=r.length,m.addEventListener("click",(function(){return a(n).then((function(){return e=n,void document.querySelector('.elements__item[data-id="'.concat(e,'"]')).remove();var e}))})),f.addEventListener("click",(function(){return u(n,o).then((function(e){var t,n=e.likes.length;!function(e,t){e.textContent=t}(v,n),(t=f).classList.contains("elements__element-like_active")?t.classList.remove("elements__element-like_active"):t.classList.add("elements__element-like_active")}))})),d.addEventListener("click",(function(){M.src=t,M.alt=e,H.textContent=e,s(U)})),i}function h(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b=document.querySelector(".edit-form"),q=document.querySelector("#card__name"),L=document.querySelector("#card__image"),g=b.querySelector("#username__title"),C=b.querySelector("#username__activity"),E=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),x=document.querySelector("#profile-popup"),w=document.querySelector("#card-popup"),A=document.querySelector("#avatar-popup"),T=A.querySelector("#avatar__image"),j=document.querySelector("#avatar-form"),D=A.querySelector("#avatar_button"),O=document.querySelector(".profile__photo-button"),I=document.querySelector("#card-form"),P=document.querySelector(".profile"),N=P.querySelector(".profile__title"),J=P.querySelector(".profile__subtitle"),U=document.querySelector("#image-popup"),H=U.querySelector(".popup__image-figcaption"),M=U.querySelector(".popup__image"),z=document.querySelector("#card_button"),V=document.querySelector("#card-form");E.addEventListener("mousedown",(function(){g.value=N.textContent,C.value=J.textContent,s(x)})),b.addEventListener("submit",(function(e){e.preventDefault(),k.textContent="Сохранение...";var t,n,r,a=g.value,u=C.value;(t=a,n=u,r={name:t,about:n},fetch("".concat(o.url,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify(r)}).then((function(e){return c(e)}))).then((function(e){N.textContent=e.name,J.textContent=e.about,d(x)})).catch((function(e){return console.log(e)})).finally((function(){k.textContent="Сохранить"}))})),k.addEventListener("mousedown",(function(){V.reset(),s(w)})),I.addEventListener("submit",(function(e){e.preventDefault(),z.textContent="Сохранение...";var r,a,u,i=q.value,l=L.value;(r=i,a=l,u={name:r,link:a},fetch("".concat(o.url,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(u)}).then((function(e){return c(e)}))).then((function(e){p.prepend(_(e.name,e.link,e._id,e.likes,e.owner._id,e.owner)),n(z,t),V.reset(),d(w)})).catch((function(e){console.log(e)})).finally((function(){z.textContent="Создать"}))})),O.addEventListener("mousedown",(function(){j.reset(),s(A)})),j.addEventListener("submit",(function(e){e.preventDefault(),D.textContent="Сохранение...";var r,a,u=T.value;(r=u,a={avatar:r},fetch("".concat(o.url,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify(a)}).then((function(e){return c(e)}))).then((function(e){O.style="background-image: url(".concat(e.avatar,")"),T.value="",n(D,t),j.reset(),d(A)})).catch((function(e){return console.log(e)})).finally((function(){D.textContent="Сохранить"}))}));var $=function(e,t){return a().then((function(t){return t.find((function(t){return t._id===e}))})).then((function(n){return n.likes.some((function(e){return e._id===t}))?function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return c(e)}))}(e):function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return c(e)}))}(e)}))},B=function(e){return function(e){return fetch("".concat(o.url,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return c(e)}))}(e)};Promise.all([fetch("".concat(o.url,"/users/me"),{headers:o.headers}).then((function(e){return c(e)})),a()]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return c}}(t,n)||h(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];N.textContent=o.name,J.textContent=o.about,O.style="background-image: url(".concat(o.avatar,")");var a=c.map((function(e){return _(e.name,e.link,e._id,e.likes,o._id,e.owner,B,$)}));p.prepend.apply(p,function(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(a))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(n.inputInvalidClass),t.classList.remove(n.errorClass),t.textContent=""}(t,r,n):function(e,t,n,r){e.classList.add(r.inputInvalidClass),t.classList.add(r.errorClass),t.textContent=n}(t,r,t.validationMessage,n)}(e,o,t),r(e,n,t)}))})),r(e,n,t)}(t,e)}))}(t)})();